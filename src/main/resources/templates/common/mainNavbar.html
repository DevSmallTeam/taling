<!-- Main Navbar-->
<header th:fragment="mainNavbar" xmlns:th="http://www.w3.org/1999/xhtml">
    <nav class="navbar">
        <!-- Search Box-->
        <div class="search-box">
            <button class="dismiss"><i class="icon-close"></i></button>
            <form id="searchForm" action="#" role="search">
                <input type="search" placeholder="What are you looking for..." class="form-control">
            </form>
        </div>
        <div class="container-fluid">
            <div class="navbar-holder d-flex align-items-center justify-content-between">
                <!-- Navbar Header-->
                <div class="navbar-header">
                    <!-- Navbar Brand --><a href="index.html" class="navbar-brand d-none d-sm-inline-block">
                    <div class="brand-text d-none d-lg-inline-block"><span>Welcome to </span><strong> Taling</strong></div>
                    <div class="brand-text d-none d-sm-inline-block d-lg-none"><strong>BD</strong></div></a>
                    <!-- Toggle Button--><a id="toggle-btn" href="#" class="menu-btn active"><span></span><span></span><span></span></a>
                </div>
                <!-- Navbar Menu -->
                <ul class="nav-menu list-unstyled d-flex flex-md-row align-items-md-center">
                    <!-- Search-->
                    <li class="nav-item d-flex align-items-center"><a id="search" href="#"><i class="icon-search"></i></a></li>
                    <!-- Notifications-->
                    <li class="nav-item dropdown"> <a id="notifications" rel="nofollow" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="nav-link"><i class="fa fa-bell-o"></i><span class="badge bg-red badge-corner">12</span></a>
                        <ul aria-labelledby="notifications" class="dropdown-menu">
                            <li><a rel="nofollow" href="#" class="dropdown-item">
                                <div class="notification">
                                    <div class="notification-content"><i class="fa fa-envelope bg-green"></i>You have 6 new messages </div>
                                    <div class="notification-time"><small>4 minutes ago</small></div>
                                </div></a></li>
                            <li><a rel="nofollow" href="#" class="dropdown-item">
                                <div class="notification">
                                    <div class="notification-content"><i class="fa fa-twitter bg-blue"></i>You have 2 followers</div>
                                    <div class="notification-time"><small>4 minutes ago</small></div>
                                </div></a></li>
                            <li><a rel="nofollow" href="#" class="dropdown-item">
                                <div class="notification">
                                    <div class="notification-content"><i class="fa fa-upload bg-orange"></i>Server Rebooted</div>
                                    <div class="notification-time"><small>4 minutes ago</small></div>
                                </div></a></li>
                            <li><a rel="nofollow" href="#" class="dropdown-item">
                                <div class="notification">
                                    <div class="notification-content"><i class="fa fa-twitter bg-blue"></i>You have 2 followers</div>
                                    <div class="notification-time"><small>10 minutes ago</small></div>
                                </div></a></li>
                            <li><a rel="nofollow" href="#" class="dropdown-item all-notifications text-center"> <strong>view all notifications                                            </strong></a></li>
                        </ul>
                    </li>
                    <!-- Messages                        -->
                    <li class="nav-item dropdown"> <a id="messages" rel="nofollow" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="nav-link"><i class="fa fa-envelope-o"></i><span class="badge bg-orange badge-corner">10</span></a>
                        <ul aria-labelledby="notifications" class="dropdown-menu">
                            <li><a rel="nofollow" href="#" class="dropdown-item d-flex">
                                <div class="msg-profile"> <img src="img/avatar-1.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                <div class="msg-body">
                                    <h3 class="h5">Jason Doe</h3><span>Sent You Message</span>
                                </div></a></li>
                            <li><a rel="nofollow" href="#" class="dropdown-item d-flex">
                                <div class="msg-profile"> <img src="img/avatar-2.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                <div class="msg-body">
                                    <h3 class="h5">Frank Williams</h3><span>Sent You Message</span>
                                </div></a></li>
                            <li><a rel="nofollow" href="#" class="dropdown-item d-flex">
                                <div class="msg-profile"> <img src="img/avatar-3.jpg" alt="..." class="img-fluid rounded-circle"></div>
                                <div class="msg-body">
                                    <h3 class="h5">Ashley Wood</h3><span>Sent You Message</span>
                                </div></a></li>
                            <li><a rel="nofollow" href="#" class="dropdown-item all-notifications text-center"> <strong>Read all messages   </strong></a></li>
                        </ul>
                    </li>
                    <!-- Languages dropdown    -->
                    <li class="nav-item dropdown"><a id="languages" rel="nofollow" data-target="#" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" class="nav-link language dropdown-toggle"><i class="fa fa-cog fa-fw"></i>设置</span></a>
                        <ul aria-labelledby="languages" class="dropdown-menu">
                            <li><a rel="nofollow"  data-toggle="modal" data-target="#myModal" class="dropdown-item"> <i class="fa fa-unlock-alt fa-fw"></i>修改密码</a></li>
<!--                            <li><a rel="nofollow" href="#" class="dropdown-item"> <img src="img/flags/16/FR.png" alt="English" class="mr-2">French</a></li>-->
                        </ul>
                    </li>
                    <!-- Logout    -->
                    <li class="nav-item"><a th:href="@{/logout}" class="nav-link logout"> <span class="d-none d-sm-inline">注销</span><i class="fa fa-sign-out"></i></a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!--修改密码模态框-->
    <div id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" class="modal fade text-left">
        <div role="document" class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 id="exampleModalLabel" class="modal-title">修改密码</h4>
                    <button type="button" data-dismiss="modal" aria-label="Close" class="close"><span aria-hidden="true">×</span></button>
                </div>
                <form id = "modifyPassword" th:action="@{/user/modifyPassword}" method="post">
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="password" class="label-material">请输入原密码</label>
                            <input id="password" type="password" name="password" placeholder="current password" class="form-control">
                        </div><div class="form-group">
                            <label for="newPassword" class="label-material">请输入新密码</label>
                            <input id="newPassword" type="password" name="newPassword" placeholder="new password" class="form-control">
                        </div><div class="form-group">
                            <label for="confirmPassword" class="label-material">请确认新密码</label>
                            <input id="confirmPassword" type="password" name="confirmPassword" placeholder="confirm password"  class="form-control">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" data-dismiss="modal" class="btn btn-secondary">取消</button>
<!--                        <button type="button" class="btn btn-primary">确认修改</button>-->
                        <input type="submit" id="login" name="btnLogin" class="btn btn-primary" value="确认修改">
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--修改密码模态框end-->
    <script>
        $(document).ready(function () {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 1500
            });
            $("#modifyPassword").validate({
                rules:{
                    password: "required",
                    newPassword:{required:true},
                    confirmPassword:{required:true,equalTo:"#newPassword"}
                },
                messages:{
                    password:{required:"原密码不能为空"},
                    newPassword:{required:"新密码不能为空"},
                    confirmPassword:{
                        required:"确认密码不能为空",
                        equalTo:"请确认密码是否一致"
                    }
                },
                submitHandler: function(form) { //通过之后回调
                    $.ajax({
                        url : "/user/modifyPassword",
                        type : "post",
                        dataType : "json",
                        data: {
                            password: $("#password").val(),
                            newPassword: $("#newPassword").val()
                        },
                        success : function(msg) {
                            if(msg.retcode == '0000'){
                                Toast.fire({
                                    type: 'success',
                                    animation: false,
                                    title: '修改密码成功!'
                                });
                                $("#myModal").modal('hide');
                                setTimeout(function () {
                                    window.location.href = msg.goHref;
                                },1500);
                            }else{
                                Toast.fire({
                                    type: 'error',
                                    title: msg.message
                                });
                            }
                        }
                    });
                },
                invalidHandler: function(form, validator) {return false;}
            });
        });
    </script>
    <style>
        .error {
            color: red;
            font-size: 12px;
        }
    </style>
</header>
